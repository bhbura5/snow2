<?xml version="1.0" encoding="UTF-8"?>
<unload unload_date="2021-07-29 18:21:35">
<sp_widget action="INSERT_OR_UPDATE">
<category>custom</category>
<client_script><![CDATA[function() {
  /* widget controller */
  var c = this;
	
	/*
	c.data.allPsts.map(function(i,el){
		el.nu
		return el
	})
	*/
	console.log(c.data.allPsts);
	
}]]></client_script>
<controller_as>c</controller_as>
<css>/** GUIDE REFERENCE https://www.getapp.com/p/sem/reporting-dashboard-software?t=Top%20Business%20Dashboard%20Software&amp;camp=adw_search&amp;utm_content=g&amp;utm_source=ps-google&amp;utm_campaign=COM_MISC_Desktop_BR-Dashboard&amp;utm_medium=cpc&amp;account_campaign_id=1508645008&amp;account_adgroup_id=58386959496&amp;ad_id=490142072826&amp;utm_term=business%20dashboard%20examples&amp;matchtype=b&amp;gclid=CjwKCAiAuoqABhAsEiwAdSkVVBTbJv1IDvENUHKh8kSVQn0rYu3oe39kkWetmkCazCkXpw8fQmWT7RoCLBIQAvD_BwE**/

@import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400&amp;display=swap');

.crisis-container{

  h3,h2,p{
    color: #000;
  }
  
  label{
  	font-weight: 500;
  }

  p{
    font-family: 'Roboto', 'Helvetica';
    font-size: 14px;
  }

  h3{
    font-family: 'Roboto Slab', serif; 
    font-weight: 300;
    font-size: 2.3em;
  }
  .crisis-title{
    h3{
      margin-top: 50px;
      margin-bottom: 40px;
      line-height: 2.625rem;
      position: relative;
      padding-bottom: 23px;
    }
    h3:after{
      content: "";
      position: absolute;
      width: 28px;
      height: 4px;
      background-color: #ffc709;
      left: 0;
      bottom: 0;
    }
  }
  
  .crisis-title-error{
  	font-family: 'Roboto','Helvetica';
    font-size: 1rem;
  }


}

.crisis-wrapper{

  padding: 23px 30px;  
  padding-right: 0;
  border: 1px solid #ffc709;
  background-color: white;
  margin-bottom: 10px;
  transition: all .5s;
}

.crisis-wrapper:hover{
  background-color: rgba(255,199,9,.3);
}

.crisis-wrapper a{
  font-size: 18px !important;
}</css>
<data_table>sp_instance</data_table>
<demo_data/>
<description/>
<docs display_value=""/>
<field_list/>
<has_preview>false</has_preview>
<id>ocl_console_crisis</id>
<internal>false</internal>
<link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
<name>OCL Console Crisis</name>
<option_schema/>
<public>false</public>
<roles/>
<script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	
	//get PSTs with 
	
	var consoleFunctions = {
		
		getAllPsts: function(){
			var allPsts = [];
			var countRoom = 1;
			
			var grPst = new GlideRecord("u_post_mortem");
			grPst.addEncodedQuery("sys_class_name=u_post_mortem^u_show_on_crise_panel=true");
			grPst.orderBy("created")
			grPst.query();
			
			while(grPst.next()){
								
				allPsts.push({
					name : grPst.getDisplayValue("short_description"),
					number : grPst.getDisplayValue("number"),
					roomUrl : grPst.getDisplayValue("u_conference_room"),
					manager : grPst.getDisplayValue("u_crisis_manager"),
					roomNumber : grPst.getDisplayValue("number").replace("PST",""),
					statusMessage : grPst.getDisplayValue("u_status_message"),
					created : grPst.getDisplayValue("sys_created_on")
				})
			}
			
			return allPsts;
		}
	}
	
	
	//retrieve all PSTS to show on the panel
	data.allPsts = consoleFunctions.getAllPsts()
	

})();]]></script>
<servicenow>false</servicenow>
<sys_class_name>sp_widget</sys_class_name>
<sys_created_by>raphael.t2232</sys_created_by>
<sys_created_on>2021-01-16 13:17:30</sys_created_on>
<sys_id>b41e18fc1bfde0d03772419fe54bcb73</sys_id>
<sys_mod_count>169</sys_mod_count>
<sys_name>OCL Console Crisis</sys_name>
<sys_package display_value="Global" source="global">global</sys_package>
<sys_policy/>
<sys_scope display_value="Global">global</sys_scope>
<sys_update_name>sp_widget_b41e18fc1bfde0d03772419fe54bcb73</sys_update_name>
<sys_updated_by>raphael.t2232</sys_updated_by>
<sys_updated_on>2021-01-29 21:55:53</sys_updated_on>
<template><![CDATA[<div>
  <!-- your widget template -->
  <div class="row crisis-container">
    <div class="crisis-title">
      <h3>Crises em andamento neste momento</h3>        
    </div>

    <div class="crisis-title-error" ng-if="!((c.data.allPsts).length > 0)">
			<div class="col-md-6">
      	<h3>No momento não existem crises disponíveis para acompanhamento no painel. <br><br> <small>Após 30 segundos a página será atualizada.</small></h3>  
      </div>
      <div class="col-md-6">
        <img src="not_found_records_crisis.png" width="495" height="345"/>
      </div>
    </div>
    
    <div ng-if="((c.data.allPsts).length > 0)" class="row">
      <div ng-repeat="pst in data.allPsts" class="crisis-wrapper">
        <div class="row">
          <div class="col-md-3">
            <label>Título</label><br>
            <p>{{pst.name}}</p>
          </div>
          <div class="col-md-1">
            <label>Número</label><br>
            <p>{{pst.number}}</p>
          </div>
          <div class="col-md-2">
            <label>Sala de Conferência</label><br>
            <a href="{{pst.roomUrl}}" target="_blank">SALA {{pst.roomNumber}}</a>
          </div>
          <div class="col-md-2">
            <label>Gestor(a) da crise</label><br>
            <p>{{pst.manager == "" ? "-" : pst.manager}}</p>
          </div>
          <div class="col-md-4">
            <label>Mensagem de status </label><br>
            <p>{{pst.statusMessage == "" ? "-" : pst.statusMessage}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>]]></template>
</sp_widget>
</unload>
